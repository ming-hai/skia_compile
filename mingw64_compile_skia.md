# Windows下使用MinGW-W64(gcc/g++或LLVM)编译Skia源码的方法 - 修改日期：2025-05-17 - 操作系统：Windows 11 64位版本 - 编译器：MinGW-W64 gcc/g++ or LLVM-MinGW - 说明1：本文档介绍Windows下使用MinGW-W64(gcc/g++)或者LLVM-MinGW编译Skia源码的方法 - 说明2：该编译Skia源码的方法，是为了适配[nim duilib](https://github.com/rhett-lee/nim_duilib)项目使用Skia库，如果用于其他库使用，可能需要修改编译参数 - 说明3：获取skia源码后，需要更新部分源码（更新方法见后续文档），否则编译无法通过。（使用了一个第三方库：expat） - 说明4：操作过程中，假设源码的根目录是D:\develop目录，如果使用其他目录，可替换为实际的目录。## 一、准备工作1. 安装python v3.11.x（如果本机已经安装了python v3，可以跳过这个步骤）    （python的主版本需要是v3，需要添加到Path环境变量，以便于能够直接用python.exe启动python程序）    （1）首先安装python    （2）在Windows的设置里面，关闭python.exe和python3.exe的"应用执行别名"，否则编译skia的脚本执行有问题。Windows设置入口：设置 -> 应用 -> 高级应用设置 -> 应用执行别名    （3）到python.exe所在目录中，复制一份python.exe，改名为python3.exe: 确保命令行参数中可以访问到python3.exe   （4）验证：确保命令行参数中可以访问到python.exe和python3.exe    2. 安装git（如果本机已经安装了git，可以跳过这个步骤）    （git需要添加到Path环境变量，确保命令行参数中可以访问到git.exe）    （1）Git For Windows: 2.44版本    （2）TortoiseGit：2.15版本    3. 获取MinGW-w64编译环境（如果本机已经安装了MinGW-w64，可以跳过这个步骤）    （1）下载网址：https://www.mingw-w64.org/downloads/    （2）mingw64 gcc/g++         下载地址：https://github.com/niXman/mingw-builds-binaries/releases         下载链接：https://github.com/niXman/mingw-builds-binaries/releases/download/15.1.0-rt_v12-rev0/x86_64-15.1.0-release-win32-seh-ucrt-rt_v12-rev0.7z         下载后解压到目录：`C:\mingw64`目录，gcc/g++最终目录为：`C:\mingw64\x86_64-15.1.0-release-win32-seh-ucrt-rt_v12-rev0\mingw64\bin`    （3）mingw64 LLVM         下载地址：https://github.com/mstorsjo/llvm-mingw/releases         下载链接：https://github.com/mstorsjo/llvm-mingw/releases/download/20250430/llvm-mingw-20250430-ucrt-x86_64.zip         下载后解压到目录：`C:\mingw64`目录，gcc/g++最终目录为：`C:\mingw64\llvm-mingw-20250430-ucrt-x86_64\bin`    4. 获取skia源码：    （1）建立目录：`D:\develop`    （2）\> `cd /d D:\develop`    （3）\> `git clone https://github.com/google/skia.git`    （4）\> `git checkout 22d94029d2ac36dfac8d631fa0d1b467f0ab45a7`    （5）备注：skia源码更新的日期：`Date: 2025/5/9 8:01:50`     5. 应用修改的代码：    （1）\> `cd /d D:\develop`    （2）下载源码和文档： \> `git clone https://github.com/rhett-lee/skia_compile`    （2） 解压`skia.2025-05-17.src.zip`到目录`skia.2025-05-17.src`中    （3） 将目录`skia.2025-05-17.src`中的所有内容，复制到`D:\develop\skia`目录中，覆盖所有同名文件    （4） 注意事项：该修改的代码的SHA-1值，需要比对，如果不是这个版本的代码，直接覆盖可能有问题。    ## 二、ninja.exe（可选，上述压缩包中已经包含此文件）   下载地址：https://github.com/ninja-build/ninja/releases/download/v1.12.1/ninja-win.zip       下载后解压，然后将ninja.exe复制到`D:\develop\skia\bin`目录中。   ## 三、编译gn.exe（可选，上述压缩包中已经包含此文件）1. 下载并编译源码：`https://github.com/rhett-lee/gn.git`    （1）\> `cd /d D:\develop`    （2）\> `git clone https://github.com/rhett-lee/gn.git`    （3）\> `cd /d D:\develop\gn`    （4）\> `python build/gen.py`    （5）\> `D:\develop\skia\bin\ninja.exe -C out`    2. 复制gn.exe文件到skia源码目录   编译完成后，将out\gn.exe 复制到`D:\develop\skia\bin`目录中。## 四、编译skia（编译器：mingw64 gcc/g++）1. 运行cmd.exe命令行环境 2. 设置PATH环境变量：    \> `SET PATH=%PATH%;C:\mingw64\x86_64-15.1.0-release-win32-seh-ucrt-rt_v12-rev0\mingw64\bin`    \> `g++ -v` 3. 进入skia源码目录：    \> `cd /d D:\develop\skia` 4. 编译skia静态库（mingw64 gcc/g++，x64）     - `.\bin\gn.exe gen out/mingw64-gcc.x64.Release --args="target_cpu=\"x64\" cc=\"gcc\" cxx=\"g++\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\"]"`     - `.\bin\ninja.exe -C out/mingw64-gcc.x64.Release`5. 编译skia静态库（mingw64 gcc/g++，x86）     - `.\bin\gn.exe gen out/mingw64-gcc.x86.Release --args="target_cpu=\"x86\" cc=\"gcc\" cxx=\"g++\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\"]"`     - `.\bin\ninja.exe -C out/mingw64-gcc.x86.Release`    ## 五、编译skia（编译器：mingw64 llvm）    1. 运行cmd.exe命令行环境 2. 设置PATH环境变量：    \> `SET PATH=%PATH%C:\mingw64\llvm-mingw-20250430-ucrt-x86_64\bin`    \> `clang++ -v` 3. 进入skia源码目录：    \> `cd /d D:\develop\skia`     4. 编译skia静态库（mingw64 llvm，x64）     - `.\bin\gn.exe gen out/mingw64-llvm.x64.Release --args="target_cpu=\"x64\" cc=\"clang\" cxx=\"clang++\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\"]"`     - `.\bin\ninja.exe -C out/mingw64-llvm.x64.Release`5. 编译skia静态库（mingw64 llvm，x86）     - `.\bin\gn.exe gen out/mingw64-llvm.x86.Release --args="target_cpu=\"x86\" cc=\"clang\" cxx=\"clang++\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\"]"`     - `.\bin\ninja.exe -C out/mingw64-llvm.x86.Release`    