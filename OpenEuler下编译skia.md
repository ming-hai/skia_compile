# OpenEuler下编译Skia源码的方法 - 修改日期：2024-09-23 - 操作系统：OpenEuler 24.03 64位版本 + UKUI桌面环境 - 编译器可选择：LLVM - 操作过程中，源码根目录是/home/develop/目录，如果使用其他目录，可替换为实际的目录 - 说明1：该编译Skia源码的方法，是为了适配[nim_duilib](https://github.com/rhett-lee/nim_duilib) 项目使用Skia库，如果用于其他库使用，可能需要修改编译参数 - 说明2：最新的编译方法中，不再使用Skia中依赖的第三方库，所以不再需要运行`python3 tools/git-sync-deps`来获取第三方库的源码## 一、准备工作1. 安装完成OpenEuler 24.03 64位版本后，需要做的工作：    （1）升级系统：`dnf update`    （2）安装UKUI界面环境：    　　　安装：`dnf install ukui`    　　　设置为界面方式启动：`systemctl set-default graphical.target`    　　　重启：`reboot`    2. gcc/g++环境确认：系统自带的版本是gcc/g++ 12.3.1，可以满足需要；3. python环境确认：系统自带的版本是3.11.6，可以满足需要；4. cmake环境确认：系统自带的版本是3.27.9，可以满足需要；5. 安装git：系统中用sudo dnf install git安装，安装后的版本号为：2.43.0；6. 安装ninja：系统中用sudo dnf install ninja-build安装，安装后的版本号为：1.11.1.1-3.oe2403；7. 安装LLVM编译环境：    （1）系统中用sudo dnf install llvm安装，安装后的版本号为：17.0.6-14.oe2403；     （2）系统中用sudo dnf install clang安装，安装后的版本号为：17.0.6-14.oe2403；8. 安装gn：系统中用sudo dnf install gn安装，安装后的版本号为：1.0.0-5.oe2403## 二、获取skia源码及相关依赖1. \> `cd /home/develop`    2. \> `git clone https://github.com/google/skia.git`    3. 备注：skia源码更新的日期：`Date: 2024/9/19 12:01:55`    4. 备注：skia库对应的版本`SHA-1: 2be350ecc20db4e8abe327e2724988b98e2416d4`    5. 更新修改代码：     - 下载需要更新的代码到本地：`git clone https://github.com/rhett-lee/skia_compile`     - 更新文件：解压`Skia.2024-09-19.src.zip`，将解压后的文件，覆盖/home/develop/skia/目录中的所有同名文件。     - 注意事项：该修改的代码的SHA-1值，需要比对，如果不是这个版本的代码，直接覆盖可能有问题，需要手工修改；     - 修改代码解决的问题：修改部分其他源码：修复运行时的几个小问题。    ## 三、编译skia（编译器：LLVM）1. 进入skia源码目录：    \> `cd /home/develop/skia`2. 编译skia静态库（LLVM.x64.Release） - `gn gen out/LLVM.x64.Release --args="target_cpu=\"x64\" cc=\"clang\" cxx=\"clang++\" clang_win_version=\"17\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\"]"`     - `ninja -C out/LLVM.x64.Release` - `ninja -C out/LLVM.x64.Release -t clean`