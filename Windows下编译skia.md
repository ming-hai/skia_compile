# Windows系统中使用LLVM或Visual Studio 2022编译Skia源码的方法 - 修改日期：2025-06-06 - 操作系统：Windows 11 64位版本 - Windows SDK：10.0.26100.0版本 - 编译器：LLVM 或者 Visual Studio 2022 中的一种 - 说明1：本文档介绍Windows系统中使用LLVM或Visual Studio 2022编译Skia源码的方法 - 说明2：该编译Skia源码的方法，是为了适配[nim duilib](https://github.com/rhett-lee/nim_duilib)项目使用Skia库，如果用于其他库使用，可能需要修改编译参数 - 说明3：为了提升Debug版本的运行性能，在Debug版本的编译中，使用Release版本相同的编译参数，只是把运行时库从/MT换成/MTd。 - 说明4：获取skia源码后，需要更新部分源码（更新方法见后续文档），否则编译无法通过。（使用了一个第三方库：expat） - 说明5：操作过程中，假设源码的根目录是`D:\develop`目录，如果使用其他目录，可替换为实际的目录。## 一、准备工作：安装必备的软件1. 安装python3（python的主版本需要是3，需要添加到Path环境变量）    （1）首先安装python3    （2）在Windows的设置里面，关闭python.exe和python3.exe的"应用执行别名"，否则编译skia的脚本执行有问题。Windows设置入口：设置 -> 应用 -> 高级应用设置 -> 应用执行别名    （3）到python.exe所在目录中，复制一份python.exe，改名为python3.exe: 确保命令行参数中可以访问到python3.exe   （4）在命令行验证：`> python3.exe --version` 可以查看python的版本号     2. 安装Git For Windows: 2.44版本，git需要添加到Path环境变量，确保命令行参数中可以访问到git.exe    3. 安装Visual Studio 2022社区版（可选）    4. 安装LLVM：20.1.0 Win64 版本    （1）安装目录：`C:\LLVM`    （2）注意事项：安装目录中，不能有空格，否则编译会遇到问题。## 二、如果只关心结果，直接用下列脚本一键完成所有操作，后续文档就不用再看了。选定一个工作目录，创建一个脚本`build.bat`，将下面已经整理好脚本复制进去，保存文件。    脚本文件内容如下：    ```echo OFFset retry_delay=10:retry_clone_skia_compileif not exist ".\skia_compile" (    git clone https://github.com/rhett-lee/skia_compile) else (           git -C ./skia_compile pull)if %errorlevel% neq 0 (    timeout /t %retry_delay% >nul    goto retry_clone_skia_compile)copy /Y .\skia_compile\windows\build_skia_all_in_one.bat .\.\build_skia_all_in_one.bat```进入命令行控制台，运行该脚本： ```.\build.bat```编译时如果获取skia_compile代码失败，可以多重试几次。    编译完成的库文件在工作目录的`skia/out`子目录中，按编译选项放在相应的子目录。    ## 三、获取skia源码和修改的源码1. 获取skia源码：    （1）\> `mkdir D:\develop`    （2）\> `cd /d D:\develop`    （3）\> `git clone https://github.com/google/skia.git`    （4）\> `git checkout 290495056ba5b737330ae7f2e6e722eeda9526f8`    2. 应用修改的代码：    （1）\> `cd /d D:\develop`    （2）\> `git clone https://github.com/rhett-lee/skia_compile`（下载源码和文档）    （3） 解压`skia.2025-06-06.src.zip`到目录`skia.2025-06-06.src`中    （4） 将目录`skia.2025-06-06.src`中的所有内容，复制到`D:\develop\skia`目录中，覆盖所有同名文件    （5） 注意事项：该修改的代码的SHA-1值，需要比对，如果不是这个版本的代码，直接覆盖可能有问题。    ## 四、编译skia（编译器：LLVM）（推荐）### （1）编译64位的Lib（x64版本）1. 首先进入VS 2022的64位命令行编译环境: （x64 Native Tools Command Prompt for VS 2022）2. 进入skia源码目录：    \> `cd /d D:\develop\skia`3. 编译skia静态库（llvm.x64.debug） - `.\bin\gn.exe gen out/llvm.x64.debug --ide="vs2022" --sln="skia" --args="target_cpu=\"x64\" cc=\"clang\" cxx=\"clang++\" clang_win=\"C:/LLVM\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\",\"/MTd\"]"`     - `.\bin\ninja.exe -C out/llvm.x64.debug`    （如果需要重新编译，可以先用命令清理：`.\bin\ninja.exe -C out/llvm.x64.debug -t clean`）    4. 编译skia静态库（llvm.x64.release） - `.\bin\gn.exe gen out/llvm.x64.release --ide="vs2022" --sln="skia" --args="target_cpu=\"x64\" cc=\"clang\" cxx=\"clang++\" clang_win=\"C:/LLVM\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\",\"/MT\"]"`     - `.\bin\ninja.exe -C out/llvm.x64.release` ### （2）编译32位的Lib（x86版本）1. 首先进入VS 2022的32位命令行编译环境: （x86 Native Tools Command Prompt for VS 2022）2. 进入skia源码目录：    \> `cd /d D:\develop\skia`3. 编译skia静态库（llvm.x86.release） - `.\bin\gn.exe gen out/llvm.x86.release --ide="vs2022" --sln="skia" --args="target_cpu=\"x86\" cc=\"clang\" cxx=\"clang++\" clang_win=\"C:/LLVM\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\",\"/MT\"]"`     - `.\bin\ninja.exe -C out/llvm.x86.release`4. 编译skia静态库（llvm.x86.debug） - `.\bin\gn.exe gen out/llvm.x86.debug --ide="vs2022" --sln="skia" --args="target_cpu=\"x86\" cc=\"clang\" cxx=\"clang++\" clang_win=\"C:/LLVM\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\",\"/MTd\"]"`     - `.\bin\ninja.exe -C out/llvm.x86.debug`## 五、编译skia（编译器：Visual Studio 2022）（不推荐）### （1）编译64位的Lib（x64版本）1. 首先进入vs 2022的64位命令行编译环境:（x64 Native Tools Command Prompt for VS 2022）2. 进入skia源码目录：    \> `cd /d D:\develop\skia`3. 编译skia静态库（msvc.x64.release） - `.\bin\gn.exe gen out/msvc.x64.release --ide="vs2022" --sln="skia" --args="target_cpu=\"x64\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\",\"/MT\"]"`     - `.\bin\ninja.exe -C out/msvc.x64.release`       4. 编译skia静态库（msvc.x64.debug） - `.\bin\gn.exe gen out/msvc.x64.debug --ide="vs2022" --sln="skia" --args="target_cpu=\"x64\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\",\"/MTd\"]"`     - `.\bin\ninja.exe -C out/msvc.x64.debug`### （2）编译32位的Lib（x86版本）1. 首先进入vs 2022的32位命令行编译环境:（x86 Native Tools Command Prompt for VS 2022）2. 进入skia源码目录：    \> `cd /d D:\develop\skia`3. 编译skia静态库（msvc.x86.release） - `.\bin\gn.exe gen out/msvc.x86.release --ide="vs2022" --sln="skia" --args="target_cpu=\"x86\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\",\"/MT\"]"`     - `.\bin\ninja.exe -C out/msvc.x86.release`       4. 编译skia静态库（msvc.x86.debug） - `.\bin\gn.exe gen out/msvc.x86.debug --ide="vs2022" --sln="skia" --args="target_cpu=\"x86\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\",\"/MTd\"]"`     - `.\bin\ninja.exe -C out/msvc.x86.debug`   ## 六、为何使用LLVM编译Skia    因为LLVM编译的代码，执行性能明显比VS好。    用VS编译的代码，运行时有明显卡顿现象，尤其时Debug版。## 七、资源链接1. Skia的编译文档库，点击访问：[skia compile](https://github.com/rhett-lee/skia_compile) 2. nim duilib的代码库，点击访问：[nim duilib](https://github.com/rhett-lee/nim_duilib) 