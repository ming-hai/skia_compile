# 统信UOS系统中使用LLVM或者gcc编译Skia源码的方法 - 修改日期：2025-05-25 - 操作系统：统信UOS桌面专业版AMD64（1070 HWE版本） - 编译器：LLVM or gcc - 说明1：本文档介绍统信UOS系统中使用LLVM或者gcc编译Skia源码的方法 - 说明2：该编译Skia源码的方法，是为了适配[nim duilib](https://github.com/rhett-lee/nim_duilib)项目使用Skia库，如果用于其他库使用，可能需要修改编译参数 - 说明3：获取skia源码后，需要更新部分源码（更新方法见后续文档），否则编译无法通过。（使用了一个第三方库：expat） - 说明4：操作过程中，假设源码的根目录是`~/develop`目录，如果使用其他目录，可替换为实际的目录。 ## 一、准备工作1：安装必备的软件1. 安装完成系统后，可用升级系统到最新：    （1）升级系统：`sudo apt update`    （2）升级系统：`sudo apt upgrade -y`   2. 安装依赖的软件```sudo apt install -y gcc g++ gdb make git cmake python3 ninja-build wget unzip \                    libfontconfig1-dev libgl1-mesa-dev libgles2-mesa-dev libegl1-mesa-dev libvulkan-dev ```安装完成后的各个软件版本信息如下：```cmake 已经是最新版 (3.22.1.1-1)。g++ 已经是最新版 (4:8.3.0-1+sign)。gcc 已经是最新版 (4:8.3.0-1+sign)。gdb 已经是最新版 (8.2.1.1-1+security)。git 已经是最新版 (1:2.20.1.3-2+dde)。libfontconfig1-dev 已经是最新版 (2.13.1.1-2+sign)。make 已经是最新版 (4.2.1.1-1+dde)。ninja-build 已经是最新版 (1.8.2-1)。python3 已经是最新版 (3.7.3.1-deepin1)。unzip 已经是最新版 (6.0.7.2-1+deepin+sign)。libegl1-mesa-dev 已经是最新版 (23.1.2.3-1)。libgl1-mesa-dev 已经是最新版 (23.1.2.3-1)。libgles2-mesa-dev 已经是最新版 (23.1.2.3-1)。wget 已经是最新版 (1.20.1.6-deepin1)。```说明：libvulkan-dev 下载失败，未安装成功    ## 二、准备工作2：必备的开发工具软件的源码下载、编译与安装（一键完成）由于UOS系统提供的开发工具软件版本太低，不能满足要求，需要使用源码编译开发工具的最新版。    这些开发工具包括binutils、python3、gcc/g++、llvm/clang/clang++、gn等。    硬件需求：      1. 最低内存需求：16GB，内存不足时编译失败    2. 硬盘空间需求：35GB左右    脚本的使用方法:1. 创建工作目录：`~/develop/`2. 将脚本复制到工作目录，并在工作目录中运行，此过程的脚本内容如下:```#!/bin/bashDEVELOP_HOME_DIR=~/develop/mkdir -p $DEVELOP_HOME_DIRcp ./uos/install_development_tools.sh $DEVELOP_HOME_DIRcd $DEVELOP_HOME_DIR./install_development_tools.sh```下载的源码保存在`$DEVELOP_HOME_DIR/src`目录，    编译好的程序安装在`$DEVELOP_HOME_DIR/install`目录中。    编译好的开发工具设置保存在`~/develop/source.sh`文件中。    由于新版的开发工具在自己安装的目录中，所以使用前先要用source设置环境变量，才能生效：```source ~/develop/source.sh```## 三、如果只关心结果，直接用下列脚本一键完成所有操作，后续文档就不用再看了。选定一个工作目录，创建一个脚本`build.sh`，将下面已经整理好脚本复制进去，保存文件。    然后在控制台，为脚本文件添加可执行权限，最后运行该脚本： ```chmod +x build.sh./build.sh```脚本文件内容如下：    ```#!/bin/bashsource ~/develop/source.shgit clone https://github.com/rhett-lee/skia_compilecp ./skia_compile/linux/build_skia_all_in_one.sh ./chmod +x ./build_skia_all_in_one.sh./build_skia_all_in_one.sh```编译时如果获取skia_compile代码失败，可以多重试几次。    编译完成的库文件在工作目录的`skia/out`子目录中，按编译选项放在相应的子目录。  ## 四、获取skia源码并更新修改代码1. 获取skia源码：    ```#!/bin/bashmkdir ~/develop  cd ~/developgit clone https://github.com/google/skia.gitgit -C ./skia checkout 22d94029d2ac36dfac8d631fa0d1b467f0ab45a7```2. 下载源码和文档，并更新skia的修改代码：    ```#!/bin/bashcd ~/developgit clone https://github.com/rhett-lee/skia_compileunzip -o ./skia_compile/skia.2025-05-17.src.zip -d ./skia/``` 更新完成后，可以到skia目录中确认一下是否更新成功```#!/bin/bashcd ~/developgit -C ./skia status``` ## 五、编译skia（编译器：LLVM）（推荐）1. 进入skia源码目录：    \> `cd ~/develop/skia`    \> `source ~/develop/source.sh`    2. 编译skia静态库（llvm.x64.Release） - `gn gen out/llvm.x64.release --args="target_cpu=\"x64\" cc=\"clang\" cxx=\"clang++\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\"]"`     - `ninja -C out/llvm.x64.release` ## 六、编译skia（编译器：gcc/g++，如果不使用LLVM编译器，也可选择用gcc/g++编译）1. 进入skia源码目录：    \> `cd ~/develop/skia`    \> `source ~/develop/source.sh`    2. 编译skia静态库（gcc.x64.release） - `gn gen out/gcc.x64.release --args="target_cpu=\"x64\" cc=\"gcc\" cxx=\"g++\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\"]"`     - `ninja -C out/gcc.x64.release`## 七、资源链接1. Skia的编译文档库，点击访问：[skia compile](https://github.com/rhett-lee/skia_compile) 2. nim duilib的代码库，点击访问：[nim duilib](https://github.com/rhett-lee/nim_duilib) 