# Ubuntu系统中使用LLVM或者gcc编译Skia源码的方法 - 修改日期：2025-05-17 - 操作系统：Ubuntu 24.04.1 desktop 64位版本（桌面环境：GNOME Wayland） - 编译器：LLVM or gcc - 说明1：本文档介绍Ubuntu系统中使用LLVM或者gcc编译Skia源码的方法 - 说明2：该编译Skia源码的方法，是为了适配[nim duilib](https://github.com/rhett-lee/nim_duilib)项目使用Skia库，如果用于其他库使用，可能需要修改编译参数 - 说明3：获取skia源码后，需要更新部分源码（更新方法见后续文档），否则编译无法通过。（使用了一个第三方库：expat） - 说明4：操作过程中，假设源码的根目录是`/home/develop`目录，如果使用其他目录，可替换为实际的目录。## 一、准备工作1. 安装完成系统后，可用升级系统到最新：    （1）升级系统：`sudo apt update`    （2）升级系统：`sudo apt upgrade`    2. 安装gcc/g++: 系统中用`sudo apt install gcc g++`安装，安装后的版本号为：13.2.0；3. gdb环境确认：系统自带，GNU gdb (Ubuntu 15.0.50.20240403-0ubuntu1)；4. 安装make: 系统中用`sudo apt install make`安装，安装后的版本号为：4.3；5. python环境确认：系统自带的版本是3.12.3，可以满足需要；6. 安装cmake: 系统中用`sudo apt install cmake`安装，安装后的版本号为：3.28.3；7. 安装git：系统中用`sudo apt install git`安装，安装后的版本号为：2.43.0；8. 安装ninja：系统中用`sudo apt install ninja-build`安装，安装后的版本号为：1.11.1；9. 安装gn：系统中用`sudo apt install generate-ninja`安装，安装后的版本号为：1000 (03d10f1)10. 安装LLVM编译环境：    （1）系统中用`sudo apt install llvm`安装，安装后的版本号为：18.1.3；     （2）系统中用`sudo apt install clang`安装，安装后的版本号为：18.1.3；11. 安装libfontconfig-dev：系统中用`sudo apt install libfontconfig-dev`，安装后的版本号为：2.15.012. 安装OpenGL：`sudo apt install libgl1-mesa-dev libgles2-mesa-dev libegl1-mesa-dev`## 二、获取skia源码并更新修改代码1. 获取skia源码：    ```#!/bin/bashmkdir /home/develop  cd /home/developgit clone https://github.com/google/skia.gitgit checkout 22d94029d2ac36dfac8d631fa0d1b467f0ab45a7```2. 下载源码和文档，并更新skia的修改代码：    ```#!/bin/bashcd /home/developgit clone https://github.com/rhett-lee/skia_compilemkdir -p skia_compile/srccd skia_compile/srcunzip ../skia.2025-05-17.src.zipcp -rf ./* /home/develop/skia/``` 更新完成后，可以到skia目录中确认一下是否更新成功```#!/bin/bashcd /home/develop/skia/git status``` ## 三、编译skia（编译器：LLVM）1. 进入skia源码目录：    \> `cd /home/develop/skia`2. 编译skia静态库（llvm.x64.Release） - `gn gen out/llvm.x64.release --args="target_cpu=\"x64\" cc=\"clang\" cxx=\"clang++\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\"]"`     - `ninja -C out/llvm.x64.release` ## 四、编译skia（编译器：gcc/g++，如果不使用LLVM编译器，也可选择用gcc/g++编译）1. 进入skia源码目录：    \> `cd /home/develop/skia`2. 编译skia静态库（gcc.x64.release） - `gn gen out/gcc.x64.release --args="target_cpu=\"x64\" cc=\"gcc\" cxx=\"g++\" is_trivial_abi=false is_official_build=true skia_use_libwebp_encode=false skia_use_libwebp_decode=false skia_use_libpng_encode=false skia_use_libpng_decode=false skia_use_zlib=false skia_use_libjpeg_turbo_encode=false skia_use_libjpeg_turbo_decode=false skia_enable_fontmgr_win_gdi=false skia_use_icu=false skia_use_expat=false skia_use_xps=false skia_enable_pdf=false skia_use_wuffs=false skia_enable_svg=true skia_use_expat=true skia_use_system_expat=false is_debug=false extra_cflags=[\"-DSK_DISABLE_LEGACY_PNG_WRITEBUFFER\"]"`     - `ninja -C out/gcc.x64.release`## 五、资源链接1. Skia的编译文档库，点击访问：[skia compile](https://github.com/rhett-lee/skia_compile) 2. nim duilib的代码库，点击访问：[nim duilib](https://github.com/rhett-lee/nim_duilib) 